<!DOCTYPE html>
<html lang="pt-BR" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Replique os backups de sua VM SQL Server do Azure para Amazon | Tiago Neves - DBA SQL Server</title>
<link rel="profile" href="https://gmpg.org/xfn/11">
<link rel="pingback" href="https://www.tiagoneves.net/blog/xmlrpc.php">

<meta name="description" content="Olá pessoal, você tem um SQL Server em uma cloud e gostaria de replicar para outra? Neste post mostro uma solução de um log shipping manual de um SQL Server no Azure para a Amazon" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Replique os backups de sua VM SQL Server do Azure para Amazon" />
<meta property="og:description" content="Olá pessoal, você tem um SQL Server em uma cloud e gostaria de replicar para outra? Neste post mostro uma solução de um log shipping manual de um SQL Server no Azure para a Amazon" />
<meta property="og:url" content="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" />
<meta property="og:image" content="https://www.tiagoneves.net/blog/wp-content/uploads/2018/07/azure-aws-01-e1532521181505.png" />
<meta property="article:published_time" content="2018-07-25" />
<meta property="article:modified_time" content="2018-07-26" />
<meta property="article:author" content="https://www.tiagoneves.net/blog/author/tiagoneves/" />
<meta property="article:tag" content="Azure" />
<meta property="article:tag" content="Casos do dia-a-dia" />
<meta property="article:tag" content="Virtual Pass BR" />
<meta property="article:tag" content="amazon" />
<meta property="article:tag" content="Azure" />
<meta property="article:tag" content="Backup" />
<meta property="article:tag" content="cloud" />
<meta property="article:tag" content="DBA-VITORIA" />
<meta property="article:tag" content="replicacao" />
<meta property="article:tag" content="Restore" />
<meta property="article:tag" content="SQL Server" />
<meta property="og:site_name" content="Tiago Neves - DBA SQL Server" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@tiagolneves" />
<meta name="robots" content="noodp,noydir" />

<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Feed para Tiago Neves - DBA SQL Server &raquo;" href="https://www.tiagoneves.net/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="Feed de comentários para Tiago Neves - DBA SQL Server &raquo;" href="https://www.tiagoneves.net/blog/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Feed de comentários para Tiago Neves - DBA SQL Server &raquo; Replique os backups de sua VM SQL Server do Azure para Amazon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/feed/" />

<script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.3.2';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-64709290-1';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-64709290-1', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>

<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.tiagoneves.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.0.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='gtranslate-style-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/gtranslate/gtranslate-style24.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-ssms2012-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/crayon-syntax-highlighter/themes/ssms2012/ssms2012.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='pt-cv-public-style-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/content-views-query-and-display-post-page/public/assets/css/cv.css?ver=2.1.2' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css' href='https://www.tiagoneves.net/blog/wp-includes/css/dist/block-library/style.min.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='collapseomatic-css-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/jquery-collapse-o-matic/light_style.css?ver=1.6' type='text/css' media='all' />
<link rel='stylesheet' id='wptg-styles-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/table-generator/css/style.css?ver=1.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpel-style-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/wp-external-links/public/css/wpel.css?ver=2.2.0' type='text/css' media='all' />
<link rel='stylesheet' id='wp-lightbox-2.min.css-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/wp-lightbox-2/styles/lightbox.min.css?ver=1.3.4' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.1' type='text/css' media='all' />
<link rel='stylesheet' id='pluto-slider-style-css' href='https://www.tiagoneves.net/blog/wp-content/themes/pluto/css/jquery.bxslider.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='pluto-fonts-css' href='//fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700&#038;ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='pluto-style-css' href='https://www.tiagoneves.net/blog/wp-content/themes/pluto/style.css?ver=5.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='tablepress-default-css' href='https://www.tiagoneves.net/blog/wp-content/tablepress-combined.min.css?ver=8' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css' href='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/css/jetpack.css?ver=6.8.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/related-posts/related-posts.min.js?ver=20150408'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/www.tiagoneves.net\/blog\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Pressione %s para Copiar, %s para Colar","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","is_debug_mode":"false","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"","home_url":"https:\/\/www.tiagoneves.net\/blog","track_download_as":"event","internal_label":"int","hash_tracking":"false"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js?ver=7.3.2'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/themes/pluto/js/jquery.bxslider.min.js?ver=5.0.2'></script>
<link rel='https://api.w.org/' href='https://www.tiagoneves.net/blog/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.tiagoneves.net/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.tiagoneves.net/blog/wp-includes/wlwmanifest.xml" />
<link rel='prev' title='1º SQL Day ES &#8211; Um dia inteiro de aprendizado e networking' href='https://www.tiagoneves.net/blog/1o-sql-day-es-um-dia-inteiro-de-aprendizado-e-networking/' />
<link rel='next' title='São Paulo recebe mais uma edição do SQL Saturday' href='https://www.tiagoneves.net/blog/sao-paulo-recebe-mais-uma-edicao-do-sql-saturday/' />
<meta name="generator" content="WordPress 5.0.2" />
<link rel="canonical" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" />
<link rel='shortlink' href='https://wp.me/p6eIyh-mW' />
<link rel="alternate" type="application/json+oembed" href="https://www.tiagoneves.net/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://www.tiagoneves.net/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F&#038;format=xml" />

<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" />
<meta property="og:title" content="Replique os backups de sua VM SQL Server do Azure para Amazon" />
<meta property="og:description" content="Relacionado" />
<meta property="og:site_name" content="Tiago Neves - DBA SQL Server" />
<meta property="og:image" content="https://www.tiagoneves.net/blog/wp-content/uploads/2018/07/azure-aws-01-e1532521181505.png" />
<meta itemscope itemtype="article" />
<meta itemprop="description" content="Relacionado" />
<meta itemprop="image" content="https://www.tiagoneves.net/blog/wp-content/uploads/2018/07/azure-aws-01-e1532521181505.png" />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel='dns-prefetch' href='//i0.wp.com' />
<link rel='dns-prefetch' href='//i1.wp.com' />
<link rel='dns-prefetch' href='//i2.wp.com' />
<link rel='dns-prefetch' href='//jetpack.wordpress.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//public-api.wordpress.com' />
<link rel='dns-prefetch' href='//0.gravatar.com' />
<link rel='dns-prefetch' href='//1.gravatar.com' />
<link rel='dns-prefetch' href='//2.gravatar.com' />
<link rel='dns-prefetch' href='//widgets.wp.com' />
<style type='text/css'>img#wpstats{display:none}</style><style></style><style type="text/css" id="custom-background-css">
body.custom-background { background-color: #e8e8e8; }
</style>
<link rel="icon" href="https://i1.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2016/03/cropped-Logo_Tiago_JPEG_512x512.png?fit=32%2C32&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i1.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2016/03/cropped-Logo_Tiago_JPEG_512x512.png?fit=192%2C192&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://i1.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2016/03/cropped-Logo_Tiago_JPEG_512x512.png?fit=180%2C180&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i1.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2016/03/cropped-Logo_Tiago_JPEG_512x512.png?fit=270%2C270&#038;ssl=1" />

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-64709290-1', 'auto');
  ga('send', 'pageview');
</script>

<style type="text/css" id="wp-custom-css">
				/*
Bem-vindo ao CSS Personalizado!

Para saber como isso funciona, veja http://wp.me/PEmnE-Bt
*/
a {
	color: blue;
}			</style>
</head>
<body class="post-template-default single single-post postid-1422 single-format-standard custom-background">
<div id="page" class="hfeed site">
<header id="masthead" class="site-header" role="banner">
<div class="site-branding">
<h1 class="site-title logo-container"><a href="https://www.tiagoneves.net/blog/" title="Tiago Neves &#8211; DBA SQL Server" rel="home" data-wpel-link="internal">
<img class='main_logo' src='https://www.tiagoneves.net/blog/wp-content/uploads/2016/04/Logo_Tiago_360x125.png' title='Tiago Neves &#8211; DBA SQL Server'></a></h1> </div>
<div id="social_icons">
<a target="_blank" href="https://www.facebook.com/TiagoNevesDBA/" title="Facebook" data-wpel-link="external" rel="nofollow external noopener noreferrer"><img src="https://www.tiagoneves.net/blog/wp-content/themes/pluto/images/facebook.png"></a>
<a target="_blank" href="https://twitter.com/tiagolneves" title="Twitter" data-wpel-link="external" rel="nofollow external noopener noreferrer"><img src="https://www.tiagoneves.net/blog/wp-content/themes/pluto/images/twitter.png"></a>
<a target="_blank" href="https:/https://www.linkedin.com/in/tiago-neves-dba/" title="Linked In" data-wpel-link="internal"><img src="https://www.tiagoneves.net/blog/wp-content/themes/pluto/images/linkedin.png"></a>
</div>
</header>
<nav id="site-navigation" class="main-navigation" role="navigation">
<div id="nav-container">
<h1 class="menu-toggle">Menu</h1>
<div class="screen-reader-text skip-link"><a href="#content" title="Skip to content" data-wpel-link="internal">Skip to content</a></div>
<div class="menu"><ul>
<li><a href="https://www.tiagoneves.net/blog/" data-wpel-link="internal">Início</a></li><li class="page_item page-item-44"><a href="https://www.tiagoneves.net/blog/clientes/" data-wpel-link="internal">Clientes</a></li>
<li class="page_item page-item-128"><a href="https://www.tiagoneves.net/blog/contatos/" data-wpel-link="internal">Contato</a></li>
<li class="page_item page-item-499"><a href="https://www.tiagoneves.net/blog/e-books/" data-wpel-link="internal">E-books</a></li>
<li class="page_item page-item-222"><a href="https://www.tiagoneves.net/blog/servicos/" data-wpel-link="internal">Serviços</a></li>
<li class="page_item page-item-5"><a href="https://www.tiagoneves.net/blog/sobre/" data-wpel-link="internal">Sobre</a></li>
</ul></div>
</div>
</nav>
<div id="content" class="site-content">
<div id="primary" class="content-area">
<main id="main" class="site-main" role="main">
<article id="post-1422" class="post-1422 post type-post status-publish format-standard has-post-thumbnail hentry category-azure category-casos-do-dia-a-dia category-virtual-pass-br tag-amazon tag-azure tag-backup tag-cloud tag-dba-vitoria tag-replicacao tag-restore tag-sql-server">
<header class="entry-header">
<h1 class="entry-title">Replique os backups de sua VM SQL Server do Azure para Amazon</h1>
<div class="entry-meta">
<span class="posted-on">Posted on <a href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" title="12:21" rel="bookmark" data-wpel-link="internal"><time class="entry-date published" datetime="2018-07-25T12:21:00+00:00">25 de julho de 2018</time><time class="updated" datetime="2018-07-26T12:49:33+00:00">26 de julho de 2018</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://www.tiagoneves.net/blog/author/tiagoneves/" title="View all posts by tiagoneves" data-wpel-link="internal">tiagoneves</a></span></span> </div>
</header>
<div id="post_thumbnail">
<img width="315" height="180" src="https://www.tiagoneves.net/blog/wp-content/uploads/2018/07/azure-aws-01-e1532521181505.png" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" /> </div>
<div class="entry-content">
<p>Olá pessoal, tudo certo?</p>
<p>No post de hoje vou compartilhar com vocês um caso que atendi em um de nossos clientes.</p>
<p>O nosso cliente tem uma VM com o SQL Server no<strong> Azure</strong> e gostaria de ter um site de <strong>DR (disaster recovery)</strong> na<strong> Amazon</strong>. Até ai tudo bem, você poderia falar &#8220;Tiago isso é fácil, o SQL Server te dá tantas possibilidades&#8221; ou até mesmo &#8220;Poxa ele pode usar a replicação no próprio Azure&#8221;. Concordo com tudo isso, mas cliente é cliente e a solicitação era &#8220;Quero uma cópia do meu SQL Server na Amazon&#8221;. Então a replicação no próprio Azure está descartada.</p>
<p>Pensei em utilizar o <strong>AlwaysOn AG</strong>, porém, a licença que ele utiliza é a edição Web que não tem suporte. Então AG descartado.</p>
<p>Passamos para próxima possibilidade que é configurar uma <strong>Replicação</strong>. Só que o custo (esforço) para configurar seria grande, mas seria uma alternativa válida também.</p>
<p>Próximo cenário seria configurar um <strong>Database Mirror</strong>, porém como os servidores estão em clouds diferentes que não estão integradas, teríamos que configurar o mirror utilizando certificado, mesmo assim não seria possível seguir com esse cenário, pois a edição Web libera você para configurar o servidor apenas como testemunha (<strong>witness</strong>).</p>
<p>Então chegamos no cenário que melhor atendeu a situação que é configurar um <strong>Log Shipping</strong>. Contudo, teríamos um esforço grande pelo mesmo motivo do mirror&#8230; &#8220;clouds diferentes não integradas&#8230;&#8221;, mas aí que entra uma solução de contorno que é criar um <strong>Log Shipping manual</strong>, que nada mais é que pegar os backups de um servidor e restaurar no outro.</p>
<p><span style="color: #808080;"><strong>Mas Tiago como que você copia os backups de um servidor para o outro? Utilizou alguma ferramenta? FTP?</strong></span></p>
<p><strong><span style="color: #ff0000;">Resposta: Não.</span></strong></p>
<p>Poderíamos utilizar ferramentas para copiar os backups ou transferir via FTP, só que o nosso serviço foi facilitado pelo cliente já que ele utiliza o serviço de backup direto em um Blob Storage, se você quiser conhecer esse serviço veja o post (<a href="https://www.tiagoneves.net/blog/fazendo-um-backup-database-no-azure/" target="_blank" rel="noopener" data-wpel-link="internal">Fazendo um backup database On-Premises no Azure</a>). Portanto, no servidor da Amazon eu precisaria apenas fazer o restore sem precisa de copiar os arquivos.</p>
<p><strong><span style="color: #808080;">Como que você recuperou os caminhos dos backups?</span></strong></p>
<p>Novamente aqui o trabalho foi facilitado pelo cliente que fez um form .Net que executa a query abaixo no MSDB e retorna as informações dos backups da instância principal que está no Azure e faz a carga dessas informações na Amazon, ou seja, um backup é realizado no Azure, ele é gravado na MSDB, de 30 em 30 segundos a aplicação valida se tem um backup novo, se tiver ele registra a informação na Amazon. Também daria para fazer um script powershell para recuperar as informações no Blob Storage, porém foi mais simples utilizar a app que o cliente fez.</p>
<div id="crayon-5c24a93e5a08f104734501" class="crayon-syntax crayon-theme-ssms2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Alternar números de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Exibir código simples"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Alternar quebras de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Abrir código em nova janela"><div class="crayon-button-icon"></div></div><span class="crayon-language">Transact-SQL</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
SELECT A.database_name,
       A.backup_start_date,
       A.backup_finish_date,
       b.physical_device_name AS Diretorio,
       A.type,
       ROW_NUMBER() OVER (PARTITION BY A.database_name ORDER BY A.backup_start_date DESC) AS Ranking
FROM msdb..backupset A
    JOIN msdb..backupmediafamily b
        ON b.media_set_id = A.media_set_id
GROUP BY A.database_name,
         A.backup_start_date,
         b.physical_device_name,
         A.backup_finish_date,
         A.type;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-2">2</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-4">4</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-6">6</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-8">8</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-10">10</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-12">12</div><div class="crayon-num" data-line="crayon-5c24a93e5a08f104734501-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a08f104734501-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-1"><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_finish_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">b</span><span class="crayon-sy">.</span><span class="crayon-i">physical_device_name</span><span class="crayon-h"> </span><span class="crayon-k">AS</span><span class="crayon-h"> </span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">ROW_NUMBER</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">OVER</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">PARTITION</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-k">ORDER</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-h"> </span><span class="crayon-k">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">AS</span><span class="crayon-h"> </span><span class="crayon-i">Ranking</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-7"><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">msdb</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-i">backupset</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">msdb</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-i">backupmediafamily</span><span class="crayon-h"> </span><span class="crayon-i">b</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">b</span><span class="crayon-sy">.</span><span class="crayon-i">media_set_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">media_set_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-10"><span class="crayon-k">GROUP</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">b</span><span class="crayon-sy">.</span><span class="crayon-i">physical_device_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a08f104734501-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_finish_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a08f104734501-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>

<p>
<a href="https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/07/Return_Query.png?ssl=1" rel="lightbox[1422] nofollow external noopener noreferrer" data-wpel-link="external" target="_blank"><img class="aligncenter wp-image-1428" src="https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/07/Return_Query.png?resize=640%2C275&#038;ssl=1" alt="" width="640" height="275" srcset="https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/07/Return_Query.png?resize=300%2C129&amp;ssl=1 300w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/07/Return_Query.png?resize=768%2C331&amp;ssl=1 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a></p>
<p><strong><span style="color: #808080;">E para fazer o restore como que você fez o controle do que já havia sido restaurado?</span></strong></p>
<p>Para controlar a sequência lógica dos backups que precisam ser restaurados e até mesmo para controlar a cadeia de log, eu criei uma tabela que chamo de &#8220;&#8221;, que extrai informações da tabela de histórico de backups que foram realizados no Azure.</p>
<div id="crayon-5c24a93e5a0a9710299920" class="crayon-syntax crayon-theme-ssms2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Alternar números de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Exibir código simples"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Alternar quebras de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Abrir código em nova janela"><div class="crayon-button-icon"></div></div><span class="crayon-language">Transact-SQL</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
CREATE TABLE [dbo].[Controle_BKP](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Nm_Database] [varchar](50) NULL,
	[Dt_Backup] [datetime] NULL,
	[Ds_Diretorio] [varchar](800) NULL,
	[Tipo_BKP] [char](1) NULL,
	[Fl_Restore] [bit] NULL DEFAULT ((0))
) ON [PRIMARY]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c24a93e5a0a9710299920-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0a9710299920-2">2</div><div class="crayon-num" data-line="crayon-5c24a93e5a0a9710299920-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0a9710299920-4">4</div><div class="crayon-num" data-line="crayon-5c24a93e5a0a9710299920-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0a9710299920-6">6</div><div class="crayon-num" data-line="crayon-5c24a93e5a0a9710299920-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0a9710299920-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c24a93e5a0a9710299920-1"><span class="crayon-k">CREATE</span><span class="crayon-h"> </span><span class="crayon-k">TABLE</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-i">Controle_BKP</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0a9710299920-2"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">ID</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">int</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-k">IDENTITY</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">NOT</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0a9710299920-3"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">Nm_Database</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">varchar</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0a9710299920-4"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">datetime</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0a9710299920-5"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">varchar</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-cn">800</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0a9710299920-6"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">Tipo_BKP</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">char</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0a9710299920-7"><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">Fl_Restore</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">bit</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-h"> </span><span class="crayon-k">DEFAULT</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0a9710299920-8"><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-k">PRIMARY</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>

<p>
Para extrair as informações da tabela de histórico para tabela de controle, fiz uma procedure que pega o último backup full, o último diferencial (se utilizar) depois do full e os últimos backups de log depois do backup full ou do backup diferencial.</p>
<div id="crayon-5c24a93e5a0b1159640733" class="crayon-syntax crayon-theme-ssms2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Alternar números de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Exibir código simples"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Alternar quebras de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Abrir código em nova janela"><div class="crayon-button-icon"></div></div><span class="crayon-language">Transact-SQL</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
/****** Object:  StoredProcedure [dbo].[stpCarga_Historico_Backup]    Script Date: 16/07/2018 20:39:09 ******/

Create PROCEDURE [dbo].[stpCarga_Historico_Backup] @dbname sysname
AS
BEGIN

---BKP FULL
	INSERT INTO Controle_BKP
    (
        Nm_Database,
        Dt_Backup,
        Ds_Diretorio,
        Tipo_BKP,
        Fl_Restore
    )
    SELECT A.database_name,
           A.backup_start_date,
           A.Diretorio,
           A.type,
           0
	FROM
    (
        SELECT A.database_name,
               A.backup_start_date,
               A.diretorio ,
               A.type,
               ROW_NUMBER() OVER (PARTITION BY A.database_name ORDER BY A.backup_start_date DESC) AS Ranking
        FROM historico_backup A
        WHERE A.type = ('D')
             AND A.database_name = @dbname
        GROUP BY A.database_name,
                 A.backup_start_date,
				 A.Diretorio,
                 A.type
    ) A
        LEFT JOIN dbo.Controle_BKP cbd
          ON cbd.Ds_Diretorio = A.Diretorio
    WHERE A.Ranking = 1
       AND cbd.Ds_Diretorio IS NULL;

-- BKP DIF

   INSERT INTO Controle_BKP
    (
        Nm_Database,
        Dt_Backup,
        Ds_Diretorio,
        Tipo_BKP,
        Fl_Restore
    )
    SELECT A.database_name,
           A.backup_start_date,
           Diretorio,
           A.type,
           0
    FROM
    (
        SELECT A.database_name,
               A.backup_start_date,
               A.Diretorio,
               A.type,
               ROW_NUMBER() OVER (PARTITION BY A.database_name ORDER BY A.backup_start_date DESC) AS Ranking
		FROM historico_backup A
        WHERE A.type = ('I')
              AND A.database_name = @dbname
			     AND a.backup_start_date &gt;=
          (
              SELECT MAX(a.backup_finish_date)
              FROM historico_backup A
              WHERE a.type = ('D')
                    AND a.database_name = @dbname
              GROUP BY a.database_name,
                       a.type)
        GROUP BY A.database_name,
                 A.backup_start_date,
				 A.Diretorio,
                 A.type
    ) A
        LEFT JOIN dbo.Controle_BKP cb
            ON cb.Ds_Diretorio = A.Diretorio
    WHERE A.Ranking = 1
          AND cb.Ds_Diretorio IS NULL;

 -- BKP LOG

    INSERT INTO Controle_BKP
    (
        Nm_Database,
        Dt_Backup,
        Ds_Diretorio,
        Tipo_BKP,
        Fl_Restore
    )
    SELECT a.database_name,
           a.backup_start_date,
           A.Diretorio,
           a.type,
           0
     FROM historico_backup A
        LEFT JOIN dbo.Controle_BKP cb
            ON cb.Nm_Database = a.database_name
               AND cb.Dt_Backup = a.backup_start_date
    WHERE a.type = ('L')
          AND a.database_name = @dbname
          AND a.backup_start_date &gt;=
          (
              SELECT MAX(a.backup_finish_date)
              FROM historico_backup A
              WHERE a.type = ('D')
                    AND a.database_name = @dbname
              GROUP BY a.database_name,
                       a.type
          )
          AND cb.Dt_Backup IS NULL
    ORDER BY a.backup_start_date;

end</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-2">2</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-4">4</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-6">6</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-8">8</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-10">10</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-12">12</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-14">14</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-16">16</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-18">18</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-20">20</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-22">22</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-24">24</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-26">26</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-28">28</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-30">30</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-32">32</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-34">34</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-36">36</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-38">38</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-40">40</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-42">42</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-44">44</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-46">46</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-48">48</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-50">50</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-52">52</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-54">54</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-56">56</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-58">58</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-60">60</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-62">62</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-64">64</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-66">66</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-68">68</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-70">70</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-72">72</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-74">74</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-76">76</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-78">78</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-80">80</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-82">82</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-84">84</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-86">86</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-88">88</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-90">90</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-92">92</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-94">94</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-96">96</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-98">98</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-100">100</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-102">102</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-104">104</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-106">106</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-108">108</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-110">110</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-112">112</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-114">114</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0b1159640733-116">116</div><div class="crayon-num" data-line="crayon-5c24a93e5a0b1159640733-117">117</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-1"><span class="crayon-c">/****** Object:&nbsp;&nbsp;StoredProcedure [dbo].[stpCarga_Historico_Backup]&nbsp;&nbsp;&nbsp;&nbsp;Script Date: 16/07/2018 20:39:09 ******/</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-2">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-3"><span class="crayon-k">Create</span><span class="crayon-h"> </span><span class="crayon-k">PROCEDURE</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-i">stpCarga_Historico_Backup</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-h"> </span><span class="crayon-i">sysname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-4"><span class="crayon-k">AS</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-5"><span class="crayon-k">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-6">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-7"><span class="crayon-c">---BKP FULL</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-8"><span class="crayon-h"> </span><span class="crayon-k">INSERT</span><span class="crayon-h"> </span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-e">Controle_BKP</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-9"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Nm_Database</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Tipo_BKP</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Fl_Restore</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-21"><span class="crayon-h"> </span><span class="crayon-k">FROM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">diretorio</span><span class="crayon-h"> </span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">ROW_NUMBER</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">OVER</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">PARTITION</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-k">ORDER</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-h"> </span><span class="crayon-k">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">AS</span><span class="crayon-h"> </span><span class="crayon-i">Ranking</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">historico_backup</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">GROUP</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-33"><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">LEFT</span><span class="crayon-h"> </span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span><span class="crayon-h"> </span><span class="crayon-i">cbd</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">cbd</span><span class="crayon-sy">.</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Ranking</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">cbd</span><span class="crayon-sy">.</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-k">IS</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-40">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-41"><span class="crayon-c">-- BKP DIF</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-42">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-43"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-k">INSERT</span><span class="crayon-h"> </span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-e">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-44"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Nm_Database</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Tipo_BKP</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Fl_Restore</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">ROW_NUMBER</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">OVER</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">PARTITION</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-k">ORDER</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-h"> </span><span class="crayon-k">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">AS</span><span class="crayon-h"> </span><span class="crayon-i">Ranking</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-63"><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">historico_backup</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'I'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-66"><span class="crayon-h"> &nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-e">MAX</span><span class="crayon-sy">(</span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_finish_date</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">historico_backup</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">GROUP</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">GROUP</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-76"><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">type</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">LEFT</span><span class="crayon-h"> </span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span><span class="crayon-h"> </span><span class="crayon-i">cb</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">cb</span><span class="crayon-sy">.</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Ranking</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">cb</span><span class="crayon-sy">.</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-k">IS</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-84"><span class="crayon-h"> </span><span class="crayon-c">-- BKP LOG</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-85">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INSERT</span><span class="crayon-h"> </span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-e">Controle_BKP</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-87"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Nm_Database</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Tipo_BKP</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Fl_Restore</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">A</span><span class="crayon-sy">.</span><span class="crayon-i">Diretorio</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">historico_backup</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">LEFT</span><span class="crayon-h"> </span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span><span class="crayon-h"> </span><span class="crayon-i">cb</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">cb</span><span class="crayon-sy">.</span><span class="crayon-i">Nm_Database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">cb</span><span class="crayon-sy">.</span><span class="crayon-i">Dt_Backup</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'L'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-e">MAX</span><span class="crayon-sy">(</span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_finish_date</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">historico_backup</span><span class="crayon-h"> </span><span class="crayon-i">A</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">GROUP</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">database_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">type</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">cb</span><span class="crayon-sy">.</span><span class="crayon-i">Dt_Backup</span><span class="crayon-h"> </span><span class="crayon-k">IS</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span></div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-115"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ORDER</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-sy">.</span><span class="crayon-i">backup_start_date</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0b1159640733-116">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0b1159640733-117"><span class="crayon-k">end</span></div></div></td>
</tr>
</table>
</div>
</div>

<p>
<strong>E agora, as tabelas de controle estão criadas. Como fazer o restore?</strong></p>
<p>O script abaixo é uma procedure que faz o restore. Para facilitar a criação dos bancos eu criei as mesmas estruturas de diretórios do servidor de origem.</p>
<p>Ao final de cada restore, a rotina faz um update na tabela de controle informando que aquele arquivo foi restaurado com sucesso.</p>
<div id="crayon-5c24a93e5a0bd669590562" class="crayon-syntax crayon-theme-ssms2012 crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Alternar números de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Exibir código simples"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Alternar quebras de linha"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Abrir código em nova janela"><div class="crayon-button-icon"></div></div><span class="crayon-language">Transact-SQL</span></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Create PROCEDURE [dbo].[stpRestauraBancos]
    @dbname sysname

AS
BEGIN

    DECLARE @caminho VARCHAR(MAX),
            @mdf VARCHAR(MAX),
            @mdf_name sysname,
            @ldf VARCHAR(MAX),
            @ldf_name sysname;

    SELECT @mdf = physical_name,
           @mdf_name = mf.name
    FROM master.sys.master_files mf
        INNER JOIN master.sys.databases db
            ON mf.database_id = db.database_id
    WHERE mf.type = 0 
          AND db.name = @dbname;
 
   SELECT @ldf = physical_name,
           @ldf_name = mf.name
    FROM master.sys.master_files mf
        INNER JOIN master.sys.databases db
            ON mf.database_id = db.database_id
    WHERE mf.type = 1 -- 1 = Log 
          AND db.name = @dbname;

        --Restaurar backup full.
        SET @caminho =
        (
            SELECT Ds_Diretorio
            FROM restore_log.dbo.Controle_BKP
            WHERE Tipo_BKP = 'D'
                  AND Fl_Restore = 0
                  AND Nm_Database = @dbname
        );

        IF @caminho IS NOT NULL     
        BEGIN
            RESTORE DATABASE @dbname
            FROM URL = @caminho
            WITH FILE = 1,
                 MOVE @mdf_name
                 TO @mdf,
                 MOVE @ldf_name
                 TO @ldf,
                 NORECOVERY,
                 NOUNLOAD,
				 STATS = 10,
                 REPLACE;

            IF @@ERROR = 0
            BEGIN
                UPDATE restore_log.dbo.Controle_BKP
                SET Fl_Restore = 1
                WHERE Ds_Diretorio = @caminho;
            END;

            PRINT '&gt;&gt;&gt;Backup Full restaurado: ' + @caminho;

        END;

        --Restarurar backup diferencial.

		DECLARE cursor_BackupDiferencial CURSOR FOR
        SELECT Ds_Diretorio
        FROM restore_log.dbo.Controle_BKP
        WHERE Tipo_BKP = 'I'
              AND Fl_Restore = 0
			  AND Dt_Backup &lt;= (SELECT MIN(Dt_Backup) FROM restore_log.dbo.Controle_BKP WHERE Tipo_BKP = 'I'
																					  AND Nm_Database = @dbname)
              AND Nm_Database = @dbname;

        OPEN cursor_BackupDiferencial;

        FETCH NEXT FROM cursor_BackupDiferencial
        INTO @caminho;

        WHILE @@FETCH_STATUS = 0
        BEGIN

            RESTORE DATABASE @dbname
            FROM URL = @caminho
            WITH FILE = 1,
                 NORECOVERY,
				 NOUNLOAD,
                 STATS = 10,
                 REPLACE;

            IF @@ERROR = 0
            BEGIN
                UPDATE restore_log.dbo.Controle_BKP
                SET Fl_Restore = 1
                WHERE Ds_Diretorio = @caminho;
            END;

            PRINT '&gt;&gt;&gt;Backup Diferencial restaurado: ' + @caminho;

            FETCH NEXT FROM cursor_BackupDiferencial
            INTO @caminho;
        END;

        CLOSE cursor_BackupDiferencial;
        DEALLOCATE cursor_BackupDiferencial;
		end
		
        --Restaurar backup de logs.
        DECLARE cursor_backup_files CURSOR FOR
        SELECT Ds_Diretorio
        FROM restore_log.dbo.Controle_BKP
        WHERE Tipo_BKP = 'L'
              AND Fl_Restore = 0
              AND Nm_Database = @dbname
			  ORDER BY Dt_Backup;

        OPEN cursor_backup_files;

        FETCH NEXT FROM cursor_backup_files
        INTO @caminho;

        WHILE @@FETCH_STATUS = 0
        BEGIN

            RESTORE LOG @dbname
            FROM URL = @caminho
            WITH FILE = 1,
                 NORECOVERY,
				 STATS = 10;

            IF @@ERROR = 0
            BEGIN
                UPDATE restore_log.dbo.Controle_BKP
                SET Fl_Restore = 1
                WHERE Ds_Diretorio = @caminho;
            END;

            PRINT '&gt;&gt;&gt;Backup de Log restaurado: ' + @caminho;

            FETCH NEXT FROM cursor_backup_files
            INTO @caminho;

        END

        CLOSE cursor_backup_files;
        DEALLOCATE cursor_backup_files;

END</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-2">2</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-4">4</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-6">6</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-8">8</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-10">10</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-12">12</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-14">14</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-16">16</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-18">18</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-20">20</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-22">22</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-24">24</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-26">26</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-28">28</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-30">30</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-32">32</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-34">34</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-36">36</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-38">38</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-40">40</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-42">42</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-44">44</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-46">46</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-48">48</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-50">50</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-52">52</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-54">54</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-56">56</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-58">58</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-60">60</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-62">62</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-64">64</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-66">66</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-68">68</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-70">70</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-72">72</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-74">74</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-76">76</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-78">78</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-80">80</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-82">82</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-84">84</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-86">86</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-88">88</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-90">90</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-92">92</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-94">94</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-96">96</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-98">98</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-100">100</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-102">102</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-104">104</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-106">106</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-108">108</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-110">110</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-112">112</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-114">114</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-116">116</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-118">118</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-120">120</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-122">122</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-124">124</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-126">126</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-128">128</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-130">130</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-132">132</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-134">134</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-136">136</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-138">138</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-140">140</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-142">142</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-144">144</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-146">146</div><div class="crayon-num" data-line="crayon-5c24a93e5a0bd669590562-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c24a93e5a0bd669590562-148">148</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-1"><span class="crayon-k">Create</span><span class="crayon-h"> </span><span class="crayon-k">PROCEDURE</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-i">stpRestauraBancos</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-h"> </span><span class="crayon-i">sysname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-4"><span class="crayon-k">AS</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-5"><span class="crayon-k">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-6">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">DECLARE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-h"> </span><span class="crayon-k">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-i">MAX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">mdf</span><span class="crayon-h"> </span><span class="crayon-k">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-i">MAX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">mdf_name</span><span class="crayon-h"> </span><span class="crayon-i">sysname</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">ldf</span><span class="crayon-h"> </span><span class="crayon-k">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-i">MAX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">ldf_name</span><span class="crayon-h"> </span><span class="crayon-i">sysname</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-12">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">mdf</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">physical_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-i">mdf_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">name</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">master</span><span class="crayon-sy">.</span><span class="crayon-i">sys</span><span class="crayon-sy">.</span><span class="crayon-i">master_files</span><span class="crayon-h"> </span><span class="crayon-i">mf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INNER</span><span class="crayon-h"> </span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">master</span><span class="crayon-sy">.</span><span class="crayon-i">sys</span><span class="crayon-sy">.</span><span class="crayon-i">databases</span><span class="crayon-h"> </span><span class="crayon-i">db</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">database_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">db</span><span class="crayon-sy">.</span><span class="crayon-i">database_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">db</span><span class="crayon-sy">.</span><span class="crayon-i">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-20"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-21"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">ldf</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">physical_name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-i">ldf_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">name</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">master</span><span class="crayon-sy">.</span><span class="crayon-i">sys</span><span class="crayon-sy">.</span><span class="crayon-i">master_files</span><span class="crayon-h"> </span><span class="crayon-i">mf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INNER</span><span class="crayon-h"> </span><span class="crayon-k ">JOIN</span><span class="crayon-h"> </span><span class="crayon-i">master</span><span class="crayon-sy">.</span><span class="crayon-i">sys</span><span class="crayon-sy">.</span><span class="crayon-i">databases</span><span class="crayon-h"> </span><span class="crayon-i">db</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">ON</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">database_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">db</span><span class="crayon-sy">.</span><span class="crayon-i">database_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">mf</span><span class="crayon-sy">.</span><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-c">-- 1 = Log </span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">db</span><span class="crayon-sy">.</span><span class="crayon-i">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-28">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">--Restaurar backup full.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SET</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-h"> </span><span class="crayon-o">=</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Tipo_BKP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'D'</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Nm_Database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-38">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">IF</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-h"> </span><span class="crayon-k">IS</span><span class="crayon-h"> </span><span class="crayon-k ">NOT</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">RESTORE</span><span class="crayon-h"> </span><span class="crayon-k">DATABASE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WITH</span><span class="crayon-h"> </span><span class="crayon-k">FILE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">MOVE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">mdf_name</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k">TO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">mdf</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">MOVE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">ldf_name</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k">TO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">ldf</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">NORECOVERY</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">NOUNLOAD</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-50"><span class="crayon-h"> </span><span class="crayon-i">STATS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">REPLACE</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-52">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">IF</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">ERROR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">UPDATE</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SET</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">PRINT</span><span class="crayon-h"> </span><span class="crayon-s">'&gt;&gt;&gt;Backup Full restaurado: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-61">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-63">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">--Restarurar backup diferencial.</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-66"><span class="crayon-h"> </span><span class="crayon-k">DECLARE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span><span class="crayon-h"> </span><span class="crayon-k">CURSOR</span><span class="crayon-h"> </span><span class="crayon-k">FOR</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Tipo_BKP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'I'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-71"><span class="crayon-h"> &nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Dt_Backup</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-e">MIN</span><span class="crayon-sy">(</span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span><span class="crayon-h"> </span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Tipo_BKP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'I'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-72"><span class="crayon-h"> &nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Nm_Database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Nm_Database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-74">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">OPEN</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-76">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FETCH</span><span class="crayon-h"> </span><span class="crayon-k">NEXT</span><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-79">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHILE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">FETCH_STATUS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-82">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">RESTORE</span><span class="crayon-h"> </span><span class="crayon-k">DATABASE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WITH</span><span class="crayon-h"> </span><span class="crayon-k">FILE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">NORECOVERY</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-87"><span class="crayon-h"> </span><span class="crayon-i">NOUNLOAD</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">STATS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">REPLACE</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-90">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">IF</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">ERROR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">UPDATE</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SET</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-97">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">PRINT</span><span class="crayon-h"> </span><span class="crayon-s">'&gt;&gt;&gt;Backup Diferencial restaurado: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-99">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FETCH</span><span class="crayon-h"> </span><span class="crayon-k">NEXT</span><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-103">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">CLOSE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">DEALLOCATE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_BackupDiferencial</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-106"><span class="crayon-h"> </span><span class="crayon-k">end</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-107"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">--Restaurar backup de logs.</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">DECLARE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span><span class="crayon-h"> </span><span class="crayon-k">CURSOR</span><span class="crayon-h"> </span><span class="crayon-k">FOR</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SELECT</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Tipo_BKP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'L'</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">AND</span><span class="crayon-h"> </span><span class="crayon-i">Nm_Database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-115"><span class="crayon-h"> &nbsp;&nbsp;</span><span class="crayon-k">ORDER</span><span class="crayon-h"> </span><span class="crayon-k">BY</span><span class="crayon-h"> </span><span class="crayon-i">Dt_Backup</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-116">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-117"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">OPEN</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-118">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-119"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FETCH</span><span class="crayon-h"> </span><span class="crayon-k">NEXT</span><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-120"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-121">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHILE</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">FETCH_STATUS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-124">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-125"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">RESTORE</span><span class="crayon-h"> </span><span class="crayon-i">LOG</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">dbname</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-126"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-127"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WITH</span><span class="crayon-h"> </span><span class="crayon-k">FILE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-128"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">NORECOVERY</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-129"><span class="crayon-h"> </span><span class="crayon-i">STATS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-130">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-131"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">IF</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">@</span><span class="crayon-i">ERROR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">BEGIN</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">UPDATE</span><span class="crayon-h"> </span><span class="crayon-i">restore_log</span><span class="crayon-sy">.</span><span class="crayon-i">dbo</span><span class="crayon-sy">.</span><span class="crayon-i">Controle_BKP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">SET</span><span class="crayon-h"> </span><span class="crayon-i">Fl_Restore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">WHERE</span><span class="crayon-h"> </span><span class="crayon-i">Ds_Diretorio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-136"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-137">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">PRINT</span><span class="crayon-h"> </span><span class="crayon-s">'&gt;&gt;&gt;Backup de Log restaurado: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-139">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-140"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">FETCH</span><span class="crayon-h"> </span><span class="crayon-k">NEXT</span><span class="crayon-h"> </span><span class="crayon-k">FROM</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">INTO</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">caminho</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-142">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">END</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-144">&nbsp;</div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-145"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">CLOSE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-146"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">DEALLOCATE</span><span class="crayon-h"> </span><span class="crayon-i">cursor_backup_files</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c24a93e5a0bd669590562-147">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c24a93e5a0bd669590562-148"><span class="crayon-k">END</span></div></div></td>
</tr>
</table>
</div>
</div>

<p>
Após a criação da procedure, eu criei um job que executa a cada 30 minutos. Isso ficou alinhado com o cliente que assumiu que poderia perder até 30 minutos de dados.</p>
<p>E assim o cliente ficou feliz por que agora tem uma réplica do seu banco de dados SQL Server do Azure na Amazon.</p>
<p>Bom pessoal por hoje é isso.</p>
<p>Um grande abraço,</p>
<p>Tiago Neves</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Compartilhe isso:</h3><div class="sd-content"><ul><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-1422" class="share-facebook sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/?share=facebook" target="_blank" title="Clique para compartilhar no Facebook" data-wpel-link="internal"><span>Facebook</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-1422" class="share-linkedin sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/?share=linkedin" target="_blank" title="Clique para compartilhar no LinkedIn" data-wpel-link="internal"><span>LinkedIn</span></a></li><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-1422" class="share-twitter sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/?share=twitter" target="_blank" title="Clique para compartilhar no Twitter" data-wpel-link="internal"><span>Twitter</span></a></li><li class="share-print"><a rel="nofollow noopener noreferrer" data-shared="" class="share-print sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/#print" target="_blank" title="Clique para imprimir" data-wpel-link="internal"><span>Imprimir</span></a></li><li class="share-telegram"><a rel="nofollow noopener noreferrer" data-shared="" class="share-telegram sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/?share=telegram" target="_blank" title="Clique para compartilhar no Telegram" data-wpel-link="internal"><span>Telegram</span></a></li><li class="share-jetpack-whatsapp"><a rel="noopener noreferrer nofollow external" data-shared="" class="share-jetpack-whatsapp sd-button share-icon wpel-icon-left" href="https://api.whatsapp.com/send?text=Replique%20os%20backups%20de%20sua%20VM%20SQL%20Server%20do%20Azure%20para%20Amazon%20https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F" target="_blank" title="Clique para compartilhar no WhatsApp" data-wpel-link="external"><span class="wpel-icon wpel-image wpel-icon-6"></span><span>WhatsApp</span></a></li><li class="share-skype"><a rel="nofollow noopener noreferrer" data-shared="sharing-skype-1422" class="share-skype sd-button share-icon" href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/?share=skype" target="_blank" title="Clique para compartilhar no Skype" data-wpel-link="internal"><span>Skype</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-92165869-1422-5c24a93e6e100' data-src='https://widgets.wp.com/likes/#blog_id=92165869&amp;post_id=1422&amp;origin=www.tiagoneves.net&amp;obj_id=92165869-1422-5c24a93e6e100' data-name='like-post-frame-92165869-1422-5c24a93e6e100'><h3 class="sd-title">Curtir isso:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Curtir</span></span> <span class="loading">Carregando...</span></div><span class='sd-text-color'></span><a class="sd-link-color" data-wpel-link="internal"></a></div>
<div id='jp-relatedposts' class='jp-relatedposts'>
<h3 class="jp-relatedposts-headline"><em>Relacionado</em></h3>
</div> </div>
<footer class="entry-meta">
This entry was posted in <a href="https://www.tiagoneves.net/blog/category/azure/" rel="category tag" data-wpel-link="internal">Azure</a>, <a href="https://www.tiagoneves.net/blog/category/casos-do-dia-a-dia/" rel="category tag" data-wpel-link="internal">Casos do dia-a-dia</a>, <a href="https://www.tiagoneves.net/blog/category/virtual-pass-br/" rel="category tag" data-wpel-link="internal">Virtual Pass BR</a> and tagged <a href="https://www.tiagoneves.net/blog/tag/amazon/" rel="tag" data-wpel-link="internal">amazon</a>, <a href="https://www.tiagoneves.net/blog/tag/azure/" rel="tag" data-wpel-link="internal">Azure</a>, <a href="https://www.tiagoneves.net/blog/tag/backup/" rel="tag" data-wpel-link="internal">Backup</a>, <a href="https://www.tiagoneves.net/blog/tag/cloud/" rel="tag" data-wpel-link="internal">cloud</a>, <a href="https://www.tiagoneves.net/blog/tag/dba-vitoria/" rel="tag" data-wpel-link="internal">DBA-VITORIA</a>, <a href="https://www.tiagoneves.net/blog/tag/replicacao/" rel="tag" data-wpel-link="internal">replicacao</a>, <a href="https://www.tiagoneves.net/blog/tag/restore/" rel="tag" data-wpel-link="internal">Restore</a>, <a href="https://www.tiagoneves.net/blog/tag/sql-server/" rel="tag" data-wpel-link="internal">SQL Server</a>. Bookmark the <a href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" title="Permalink to Replique os backups de sua VM SQL Server do Azure para Amazon" rel="bookmark" data-wpel-link="internal">permalink</a>.
</footer>
</article>
<nav role="navigation" id="nav-below" class="post-navigation">
<h1 class="screen-reader-text">Post navigation</h1>
<div class="nav-previous"><a href="https://www.tiagoneves.net/blog/1o-sql-day-es-um-dia-inteiro-de-aprendizado-e-networking/" rel="prev" data-wpel-link="internal"><span class="meta-nav">&larr;</span> 1º SQL Day ES &#8211; Um dia inteiro de aprendizado e networking</a></div> <div class="nav-next"><a href="https://www.tiagoneves.net/blog/sao-paulo-recebe-mais-uma-edicao-do-sql-saturday/" rel="next" data-wpel-link="internal">São Paulo recebe mais uma edição do SQL Saturday <span class="meta-nav">&rarr;</span></a></div>
</nav>
<div id="comments" class="comments-area">
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">Deixe uma resposta <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/#respond" style="display:none;" data-wpel-link="internal">Cancelar resposta</a></small>
</h3>
<form id="commentform" class="comment-form">
<iframe title="Formulário de comentário" src="https://jetpack.wordpress.com/jetpack-comment/?blogid=92165869&#038;postid=1422&#038;comment_registration=0&#038;require_name_email=1&#038;stc_enabled=1&#038;stb_enabled=1&#038;show_avatars=1&#038;avatar_default=mystery&#038;greeting=Deixe+uma+resposta&#038;greeting_reply=Deixe+uma+resposta+para+%25s&#038;color_scheme=light&#038;lang=pt_BR&#038;jetpack_version=6.8.1&#038;show_cookie_consent=10&#038;has_cookie_consent=0&#038;sig=577c7a44971f37157c10fde591590ed565d437ca#parent=https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F" style="width:100%; height: 430px; border:0;" name="jetpack_remote_comment" class="jetpack_remote_comment" id="jetpack_remote_comment" sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups"></iframe>
<!--[if !IE]><!-->
<script>
						document.addEventListener('DOMContentLoaded', function () {
							var commentForms = document.getElementsByClassName('jetpack_remote_comment');
							for (var i = 0; i < commentForms.length; i++) {
								commentForms[i].allowTransparency = false;
								commentForms[i].scrolling = 'no';
							}
						});
					</script>
<!--<![endif]-->
</form>
</div>
<input type="hidden" name="comment_parent" id="comment_parent" value="" />
</div>
</main>
</div>
<div id="secondary" class="widget-area" role="complementary">
<aside id="media_image-2" class="widget widget_media_image"><a href="http://mtac.org.br/" target="_blank" data-wpel-link="external" rel="nofollow external noopener noreferrer"><img class="image aligncenter" src="https://www.tiagoneves.net/blog/imagens/MTAC.png" alt="" width="1600" height="689" /></a></aside><aside id="media_image-4" class="widget widget_media_image"><a href="https://www.fabriciolima.net/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer"><img width="300" height="101" src="https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?fit=300%2C101&amp;ssl=1" class="image wp-image-1503  attachment-medium size-medium" alt="" style="max-width: 100%; height: auto;" srcset="https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?w=2568&amp;ssl=1 2568w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?resize=300%2C101&amp;ssl=1 300w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?resize=768%2C258&amp;ssl=1 768w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?resize=1024%2C345&amp;ssl=1 1024w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?w=1280&amp;ssl=1 1280w, https://i0.wp.com/www.tiagoneves.net/blog/wp-content/uploads/2018/11/LogoEscura.png?w=1920&amp;ssl=1 1920w" sizes="(max-width: 300px) 100vw, 300px" /></a></aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://www.tiagoneves.net/blog/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:">
</label>
<input type="submit" class="search-submit" value="Search">
</form></aside> <aside id="recent-posts-2" class="widget widget_recent_entries"> <h1 class="widget-title">Posts recentes</h1> <ul>
<li>
<a href="https://www.tiagoneves.net/blog/voce-sabe-a-diferenca-entre-uma-consulta-sargable-e-non-sargable/" data-wpel-link="internal">Você sabe a diferença entre uma consulta Sargable e Non-Sargable?</a>
</li>
<li>
<a href="https://www.tiagoneves.net/blog/sao-paulo-recebe-mais-uma-edicao-do-sql-saturday/" data-wpel-link="internal">São Paulo recebe mais uma edição do SQL Saturday</a>
</li>
<li>
<a href="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" data-wpel-link="internal">Replique os backups de sua VM SQL Server do Azure para Amazon</a>
</li>
<li>
<a href="https://www.tiagoneves.net/blog/1o-sql-day-es-um-dia-inteiro-de-aprendizado-e-networking/" data-wpel-link="internal">1º SQL Day ES &#8211; Um dia inteiro de aprendizado e networking</a>
</li>
<li>
<a href="https://www.tiagoneves.net/blog/como-configurar-a-geo-replicacao-em-um-azure-sql-database/" data-wpel-link="internal">Como configurar a geo-replicação em um Azure SQL Database</a>
</li>
</ul>
</aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Arquivos</h1> <ul>
<li><a href="https://www.tiagoneves.net/blog/2018/10/" data-wpel-link="internal">outubro 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2018/09/" data-wpel-link="internal">setembro 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2018/07/" data-wpel-link="internal">julho 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2018/06/" data-wpel-link="internal">junho 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2018/02/" data-wpel-link="internal">fevereiro 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2018/01/" data-wpel-link="internal">janeiro 2018</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/11/" data-wpel-link="internal">novembro 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/10/" data-wpel-link="internal">outubro 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/08/" data-wpel-link="internal">agosto 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/07/" data-wpel-link="internal">julho 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/05/" data-wpel-link="internal">maio 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/04/" data-wpel-link="internal">abril 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/03/" data-wpel-link="internal">março 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2017/01/" data-wpel-link="internal">janeiro 2017</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/12/" data-wpel-link="internal">dezembro 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/11/" data-wpel-link="internal">novembro 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/10/" data-wpel-link="internal">outubro 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/09/" data-wpel-link="internal">setembro 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/08/" data-wpel-link="internal">agosto 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/07/" data-wpel-link="internal">julho 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/06/" data-wpel-link="internal">junho 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/05/" data-wpel-link="internal">maio 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/04/" data-wpel-link="internal">abril 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/03/" data-wpel-link="internal">março 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2016/02/" data-wpel-link="internal">fevereiro 2016</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/12/" data-wpel-link="internal">dezembro 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/11/" data-wpel-link="internal">novembro 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/10/" data-wpel-link="internal">outubro 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/09/" data-wpel-link="internal">setembro 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/08/" data-wpel-link="internal">agosto 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/07/" data-wpel-link="internal">julho 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/06/" data-wpel-link="internal">junho 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/05/" data-wpel-link="internal">maio 2015</a></li>
<li><a href="https://www.tiagoneves.net/blog/2015/04/" data-wpel-link="internal">abril 2015</a></li>
</ul>
</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categorias</h1> <ul>
<li class="cat-item cat-item-212"><a href="https://www.tiagoneves.net/blog/category/azure/" data-wpel-link="internal">Azure</a>
</li>
<li class="cat-item cat-item-210"><a href="https://www.tiagoneves.net/blog/category/backup/" data-wpel-link="internal">Backup</a>
</li>
<li class="cat-item cat-item-2"><a href="https://www.tiagoneves.net/blog/category/casos-do-dia-a-dia/" data-wpel-link="internal">Casos do dia-a-dia</a>
</li>
<li class="cat-item cat-item-45"><a href="https://www.tiagoneves.net/blog/category/certificacao/" data-wpel-link="internal">Certificação</a>
</li>
<li class="cat-item cat-item-69"><a href="https://www.tiagoneves.net/blog/category/ebooks/" data-wpel-link="internal">Ebooks</a>
</li>
<li class="cat-item cat-item-3"><a href="https://www.tiagoneves.net/blog/category/eventos/" data-wpel-link="internal">Eventos</a>
</li>
<li class="cat-item cat-item-44"><a href="https://www.tiagoneves.net/blog/category/microsoft/" data-wpel-link="internal">Microsoft</a>
</li>
<li class="cat-item cat-item-4"><a href="https://www.tiagoneves.net/blog/category/scripts/" data-wpel-link="internal">Scripts</a>
</li>
<li class="cat-item cat-item-1"><a href="https://www.tiagoneves.net/blog/category/sem-categoria/" data-wpel-link="internal">Sem categoria</a>
</li>
<li class="cat-item cat-item-220"><a href="https://www.tiagoneves.net/blog/category/sqlserver-2016/sql-server-2017/" data-wpel-link="internal">SQL Server 2017</a>
</li>
<li class="cat-item cat-item-221"><a href="https://www.tiagoneves.net/blog/category/sql-server-on-linux/" data-wpel-link="internal">SQL Server On Linux</a>
</li>
<li class="cat-item cat-item-16"><a href="https://www.tiagoneves.net/blog/category/sqlserver-2014/" data-wpel-link="internal">SQLServer 2014</a>
</li>
<li class="cat-item cat-item-26"><a href="https://www.tiagoneves.net/blog/category/sqlserver-2016/" data-wpel-link="internal">SQLServer 2016</a>
</li>
<li class="cat-item cat-item-20"><a href="https://www.tiagoneves.net/blog/category/sqlserver-geral/" data-wpel-link="internal">SQLServer Geral</a>
</li>
<li class="cat-item cat-item-138"><a href="https://www.tiagoneves.net/blog/category/troubleshooting/" data-wpel-link="internal">Troubleshooting</a>
</li>
<li class="cat-item cat-item-239"><a href="https://www.tiagoneves.net/blog/category/tuning/" data-wpel-link="internal">Tuning</a>
</li>
<li class="cat-item cat-item-5"><a href="https://www.tiagoneves.net/blog/category/virtual-pass-br/" data-wpel-link="internal">Virtual Pass BR</a>
</li>
</ul>
</aside><aside id="nav_menu-8" class="widget widget_nav_menu"><h1 class="widget-title">Eventos Comunidade SQL Server</h1><div class="menu-eventos-comunidade-sql-server-container"><ul id="menu-eventos-comunidade-sql-server" class="menu"><li id="menu-item-890" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-890"><a target="_blank" href="http://sqlserveres.com.br" data-wpel-link="external" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>04/08/2018 &#8211; SQL Day &#8211; ES</a></li>
<li id="menu-item-1184" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1184"><a target="_blank" href="http://www.sqlsaturday.com/792/eventhome.aspx" data-wpel-link="external" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>25/08/2018 &#8211; SQL Saturday Brasilia</a></li>
<li id="menu-item-887" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-887"><a target="_blank" href="http://sqlserveres.com.br" data-wpel-link="external" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>15/09/2018 &#8211; 9º Encontro SQL Server ES</a></li>
</ul></div></aside><aside id="nav_menu-6" class="widget widget_nav_menu"><h1 class="widget-title">Blog&#8217;s Recomendados</h1><div class="menu-blogs-recomendados-container"><ul id="menu-blogs-recomendados" class="menu"><li id="menu-item-56" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-56"><a href="https://www.dirceuresende.com/blog/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Dirceu Resende</a></li>
<li id="menu-item-55" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-55"><a href="http://www.fabriciolima.net/blog/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Fabricio Lima</a></li>
<li id="menu-item-58" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://http://blogfabiano.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Fabiano Amorim</a></li>
<li id="menu-item-59" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="https://luanmorenodba.wordpress.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Luan Moreno</a></li>
<li id="menu-item-60" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-60"><a href="https://marcelodba.wordpress.com" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Marcelo Fernandes</a></li>
<li id="menu-item-61" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-61"><a href="http://www.mcdbabrasil.com.br/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Nilton Pinheiro</a></li>
<li id="menu-item-57" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://www.sqlskills.com/blogs/paul/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Paul S. Randal</a></li>
<li id="menu-item-605" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-605"><a href="https://sqlcrespi.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Rodrigo Crespi</a></li>
<li id="menu-item-345" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-345"><a href="http://www.sqlskills.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>SQLSkills</a></li>
<li id="menu-item-346" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-346"><a href="http://www.sqlservercentral.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>SQL Server Central</a></li>
<li id="menu-item-347" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-347"><a href="http://www.sqlpass.org/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>SQL Pass</a></li>
<li id="menu-item-348" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-348"><a href="https://www.simple-talk.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Simple Talk</a></li>
<li id="menu-item-349" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-349"><a href="http://www.sqlmag.com/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>SQL Server Magazine</a></li>
<li id="menu-item-344" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-344"><a href="http://http://www.virtualpass.com.br/" data-wpel-link="external" target="_blank" rel="nofollow external noopener noreferrer" class="wpel-icon-left"><span class="wpel-icon wpel-image wpel-icon-6"></span>Virtual Pass BR</a></li>
</ul></div></aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h1 class="widget-title">Tags</h1><div class="tagcloud"><a href="https://www.tiagoneves.net/blog/tag/24hpass/" class="tag-cloud-link tag-link-61 tag-link-position-1" style="font-size: 8pt;" aria-label="24hPass (2 itens)" data-wpel-link="internal">24hPass</a>
<a href="https://www.tiagoneves.net/blog/tag/azure/" class="tag-cloud-link tag-link-213 tag-link-position-2" style="font-size: 12.077669902913pt;" aria-label="Azure (5 itens)" data-wpel-link="internal">Azure</a>
<a href="https://www.tiagoneves.net/blog/tag/backup/" class="tag-cloud-link tag-link-214 tag-link-position-3" style="font-size: 9.631067961165pt;" aria-label="Backup (3 itens)" data-wpel-link="internal">Backup</a>
<a href="https://www.tiagoneves.net/blog/tag/dba/" class="tag-cloud-link tag-link-134 tag-link-position-4" style="font-size: 15.067961165049pt;" aria-label="DBA (9 itens)" data-wpel-link="internal">DBA</a>
<a href="https://www.tiagoneves.net/blog/tag/dba-vitoria/" class="tag-cloud-link tag-link-203 tag-link-position-5" style="font-size: 16.563106796117pt;" aria-label="DBA-VITORIA (12 itens)" data-wpel-link="internal">DBA-VITORIA</a>
<a href="https://www.tiagoneves.net/blog/tag/dba-es/" class="tag-cloud-link tag-link-207 tag-link-position-6" style="font-size: 15.067961165049pt;" aria-label="DBA ES (9 itens)" data-wpel-link="internal">DBA ES</a>
<a href="https://www.tiagoneves.net/blog/tag/dba-remoto/" class="tag-cloud-link tag-link-223 tag-link-position-7" style="font-size: 9.631067961165pt;" aria-label="DBA Remoto (3 itens)" data-wpel-link="internal">DBA Remoto</a>
<a href="https://www.tiagoneves.net/blog/tag/espirito-santo/" class="tag-cloud-link tag-link-145 tag-link-position-8" style="font-size: 9.631067961165pt;" aria-label="Espirito Santo (3 itens)" data-wpel-link="internal">Espirito Santo</a>
<a href="https://www.tiagoneves.net/blog/tag/high-availability/" class="tag-cloud-link tag-link-29 tag-link-position-9" style="font-size: 8pt;" aria-label="High Availability (2 itens)" data-wpel-link="internal">High Availability</a>
<a href="https://www.tiagoneves.net/blog/tag/install/" class="tag-cloud-link tag-link-18 tag-link-position-10" style="font-size: 8pt;" aria-label="Install (2 itens)" data-wpel-link="internal">Install</a>
<a href="https://www.tiagoneves.net/blog/tag/linkedserver/" class="tag-cloud-link tag-link-33 tag-link-position-11" style="font-size: 8pt;" aria-label="LINKEDSERVER (2 itens)" data-wpel-link="internal">LINKEDSERVER</a>
<a href="https://www.tiagoneves.net/blog/tag/linux/" class="tag-cloud-link tag-link-175 tag-link-position-12" style="font-size: 10.990291262136pt;" aria-label="Linux (4 itens)" data-wpel-link="internal">Linux</a>
<a href="https://www.tiagoneves.net/blog/tag/local-group/" class="tag-cloud-link tag-link-211 tag-link-position-13" style="font-size: 9.631067961165pt;" aria-label="Local Group (3 itens)" data-wpel-link="internal">Local Group</a>
<a href="https://www.tiagoneves.net/blog/tag/microsoft/" class="tag-cloud-link tag-link-47 tag-link-position-14" style="font-size: 16.155339805825pt;" aria-label="Microsoft (11 itens)" data-wpel-link="internal">Microsoft</a>
<a href="https://www.tiagoneves.net/blog/tag/migracao/" class="tag-cloud-link tag-link-87 tag-link-position-15" style="font-size: 8pt;" aria-label="migracao (2 itens)" data-wpel-link="internal">migracao</a>
<a href="https://www.tiagoneves.net/blog/tag/oracle/" class="tag-cloud-link tag-link-34 tag-link-position-16" style="font-size: 9.631067961165pt;" aria-label="ORACLE (3 itens)" data-wpel-link="internal">ORACLE</a>
<a href="https://www.tiagoneves.net/blog/tag/pass/" class="tag-cloud-link tag-link-60 tag-link-position-17" style="font-size: 19.417475728155pt;" aria-label="Pass (20 itens)" data-wpel-link="internal">Pass</a>
<a href="https://www.tiagoneves.net/blog/tag/pass-chapter/" class="tag-cloud-link tag-link-143 tag-link-position-18" style="font-size: 10.990291262136pt;" aria-label="PASS CHAPTER (4 itens)" data-wpel-link="internal">PASS CHAPTER</a>
<a href="https://www.tiagoneves.net/blog/tag/performance/" class="tag-cloud-link tag-link-54 tag-link-position-19" style="font-size: 9.631067961165pt;" aria-label="PERFORMANCE (3 itens)" data-wpel-link="internal">PERFORMANCE</a>
<a href="https://www.tiagoneves.net/blog/tag/query-store/" class="tag-cloud-link tag-link-30 tag-link-position-20" style="font-size: 8pt;" aria-label="Query Store (2 itens)" data-wpel-link="internal">Query Store</a>
<a href="https://www.tiagoneves.net/blog/tag/restore/" class="tag-cloud-link tag-link-37 tag-link-position-21" style="font-size: 9.631067961165pt;" aria-label="Restore (3 itens)" data-wpel-link="internal">Restore</a>
<a href="https://www.tiagoneves.net/blog/tag/security/" class="tag-cloud-link tag-link-68 tag-link-position-22" style="font-size: 8pt;" aria-label="security (2 itens)" data-wpel-link="internal">security</a>
<a href="https://www.tiagoneves.net/blog/tag/seguranca/" class="tag-cloud-link tag-link-65 tag-link-position-23" style="font-size: 10.990291262136pt;" aria-label="Segurança (4 itens)" data-wpel-link="internal">Segurança</a>
<a href="https://www.tiagoneves.net/blog/tag/sql/" class="tag-cloud-link tag-link-43 tag-link-position-24" style="font-size: 9.631067961165pt;" aria-label="SQL (3 itens)" data-wpel-link="internal">SQL</a>
<a href="https://www.tiagoneves.net/blog/tag/sql2014/" class="tag-cloud-link tag-link-17 tag-link-position-25" style="font-size: 8pt;" aria-label="SQL2014 (2 itens)" data-wpel-link="internal">SQL2014</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlpass/" class="tag-cloud-link tag-link-9 tag-link-position-26" style="font-size: 10.990291262136pt;" aria-label="SQLPASS (4 itens)" data-wpel-link="internal">SQLPASS</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlsat/" class="tag-cloud-link tag-link-10 tag-link-position-27" style="font-size: 15.067961165049pt;" aria-label="SQLSat (9 itens)" data-wpel-link="internal">SQLSat</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlsatbsb/" class="tag-cloud-link tag-link-91 tag-link-position-28" style="font-size: 9.631067961165pt;" aria-label="SQLSatBSB (3 itens)" data-wpel-link="internal">SQLSatBSB</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlsatjoinville/" class="tag-cloud-link tag-link-12 tag-link-position-29" style="font-size: 8pt;" aria-label="SQLSatJoinville (2 itens)" data-wpel-link="internal">SQLSatJoinville</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlsaturday/" class="tag-cloud-link tag-link-13 tag-link-position-30" style="font-size: 9.631067961165pt;" aria-label="SQLSaturday (3 itens)" data-wpel-link="internal">SQLSaturday</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-saturday/" class="tag-cloud-link tag-link-117 tag-link-position-31" style="font-size: 13.708737864078pt;" aria-label="SQL Saturday (7 itens)" data-wpel-link="internal">SQL Saturday</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlserver/" class="tag-cloud-link tag-link-14 tag-link-position-32" style="font-size: 17.106796116505pt;" aria-label="SQLServer (13 itens)" data-wpel-link="internal">SQLServer</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server/" class="tag-cloud-link tag-link-35 tag-link-position-33" style="font-size: 22pt;" aria-label="SQL Server (31 itens)" data-wpel-link="internal">SQL Server</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-2008/" class="tag-cloud-link tag-link-39 tag-link-position-34" style="font-size: 8pt;" aria-label="SQL Server 2008 (2 itens)" data-wpel-link="internal">SQL Server 2008</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-2012/" class="tag-cloud-link tag-link-32 tag-link-position-35" style="font-size: 8pt;" aria-label="SQL Server 2012 (2 itens)" data-wpel-link="internal">SQL Server 2012</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-2014/" class="tag-cloud-link tag-link-136 tag-link-position-36" style="font-size: 9.631067961165pt;" aria-label="SQL Server 2014 (3 itens)" data-wpel-link="internal">SQL Server 2014</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-2016/" class="tag-cloud-link tag-link-27 tag-link-position-37" style="font-size: 13.708737864078pt;" aria-label="SQL SERVER 2016 (7 itens)" data-wpel-link="internal">SQL SERVER 2016</a>
<a href="https://www.tiagoneves.net/blog/tag/sqlserver2016/" class="tag-cloud-link tag-link-28 tag-link-position-38" style="font-size: 10.990291262136pt;" aria-label="SQLSERVER2016 (4 itens)" data-wpel-link="internal">SQLSERVER2016</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-es/" class="tag-cloud-link tag-link-189 tag-link-position-39" style="font-size: 10.990291262136pt;" aria-label="SQL SERVER ES (4 itens)" data-wpel-link="internal">SQL SERVER ES</a>
<a href="https://www.tiagoneves.net/blog/tag/sql-server-on-linux/" class="tag-cloud-link tag-link-177 tag-link-position-40" style="font-size: 9.631067961165pt;" aria-label="SQL Server on Linux (3 itens)" data-wpel-link="internal">SQL Server on Linux</a>
<a href="https://www.tiagoneves.net/blog/tag/tempdb/" class="tag-cloud-link tag-link-105 tag-link-position-41" style="font-size: 9.631067961165pt;" aria-label="Tempdb (3 itens)" data-wpel-link="internal">Tempdb</a>
<a href="https://www.tiagoneves.net/blog/tag/tiagodba/" class="tag-cloud-link tag-link-119 tag-link-position-42" style="font-size: 13.708737864078pt;" aria-label="tiagodba (7 itens)" data-wpel-link="internal">tiagodba</a>
<a href="https://www.tiagoneves.net/blog/tag/tiago-neves/" class="tag-cloud-link tag-link-115 tag-link-position-43" style="font-size: 13.029126213592pt;" aria-label="Tiago Neves (6 itens)" data-wpel-link="internal">Tiago Neves</a>
<a href="https://www.tiagoneves.net/blog/tag/tiagonevesdba/" class="tag-cloud-link tag-link-116 tag-link-position-44" style="font-size: 12.077669902913pt;" aria-label="tiagonevesdba (5 itens)" data-wpel-link="internal">tiagonevesdba</a>
<a href="https://www.tiagoneves.net/blog/tag/vitoria/" class="tag-cloud-link tag-link-144 tag-link-position-45" style="font-size: 10.990291262136pt;" aria-label="Vitoria (4 itens)" data-wpel-link="internal">Vitoria</a></div>
</aside><aside id="blog_subscription-2" class="widget jetpack_subscription_widget"><h1 class="widget-title">Assinar Blog por Email</h1>
<form action="#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2">
<div id="subscribe-text"><p>Digite seu endereço de email para assinar este blog e receber notificações de novas publicações por email.</p>
</div><p>Junte-se a 215 outros assinantes</p>
<p id="subscribe-email">
<label id="jetpack-subscribe-label" for="subscribe-field-blog_subscription-2">
Endereço de email </label>
<input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-2" placeholder="Endereço de email" />
</p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe" />
<input type="hidden" name="source" value="https://www.tiagoneves.net/blog/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon/" />
<input type="hidden" name="sub-type" value="widget" />
<input type="hidden" name="redirect_fragment" value="blog_subscription-2" />
<input type="submit" value="Assinar" name="jetpack_subscriptions_widget" />
</p>
</form>
<script>
			/*
			Custom functionality for safari and IE
			 */
			(function( d ) {
				// In case the placeholder functionality is available we remove labels
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.querySelector( 'label[for=subscribe-field-blog_subscription-2]' );
						label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
						label.style.position = 'absolute';
						label.style.height   = '1px';
						label.style.width    = '1px';
						label.style.overflow = 'hidden';
				}

				// Make sure the email value is filled in before allowing submit
				var form = d.getElementById('subscribe-blog-blog_subscription-2'),
					input = d.getElementById('subscribe-field-blog_subscription-2'),
					handler = function( event ) {
						if ( '' === input.value ) {
							input.focus();

							if ( event.preventDefault ){
								event.preventDefault();
							}

							return false;
						}
					};

				if ( window.addEventListener ) {
					form.addEventListener( 'submit', handler, false );
				} else {
					form.attachEvent( 'onsubmit', handler );
				}
			})( document );
			</script>
</aside> </div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div id="footer-container">
<div id="footer-navigation">
<div class="menu"><ul>
<li><a href="https://www.tiagoneves.net/blog/" data-wpel-link="internal">Início</a></li><li class="page_item page-item-44"><a href="https://www.tiagoneves.net/blog/clientes/" data-wpel-link="internal">Clientes</a></li>
<li class="page_item page-item-128"><a href="https://www.tiagoneves.net/blog/contatos/" data-wpel-link="internal">Contato</a></li>
<li class="page_item page-item-499"><a href="https://www.tiagoneves.net/blog/e-books/" data-wpel-link="internal">E-books</a></li>
<li class="page_item page-item-222"><a href="https://www.tiagoneves.net/blog/servicos/" data-wpel-link="internal">Serviços</a></li>
<li class="page_item page-item-5"><a href="https://www.tiagoneves.net/blog/sobre/" data-wpel-link="internal">Sobre</a></li>
</ul></div>
</div>
<div id="footertext">
Direitos reservados © 2015-2017 - Tiago Neves </div>
</div>
</footer>
</div>
<script type='text/javascript'>
var colomatduration = 'fast';
var colomatslideEffect = 'slideFade';
var colomatpauseInit = '';
var colomattouchstart = '';
</script> <div style="display:none">
</div>
<div id="su-footer-links" style="text-align: center;"></div>

<span class='ocultar'>SQL, sql server, sql server 2008, sql server 2008 R2, sql server 2012, sql server 2014, Consultoria, Consultor, DBA, dba, dba remoto, Vitória, Vila Velha, Espírito Santo, ES, Consultoria SQL em Vtória, Prestação de serviço, prestar serviço, banco de dados, consultoria em banco de dados, consultor de banco de dados sql, consultor de banco de dados sql server,tiago,tiagodba,tiagonevesdba, tiago neves solucoes sql,tiagoslqserver</span>

<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/www.tiagoneves.net\/blog\/replique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon\/":1422};
	</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/photon/photon.min.js?ver=20130122'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var PT_CV_PUBLIC = {"_prefix":"pt-cv-","page_to_show":"5","_nonce":"a94d0be8b6","is_admin":"","is_mobile":"","ajaxurl":"https:\/\/www.tiagoneves.net\/blog\/wp-admin\/admin-ajax.php","lang":"","loading_image_src":"data:image\/gif;base64,R0lGODlhDwAPALMPAMrKygwMDJOTkz09PZWVla+vr3p6euTk5M7OzuXl5TMzMwAAAJmZmWZmZszMzP\/\/\/yH\/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgAPACwAAAAADwAPAAAEQvDJaZaZOIcV8iQK8VRX4iTYoAwZ4iCYoAjZ4RxejhVNoT+mRGP4cyF4Pp0N98sBGIBMEMOotl6YZ3S61Bmbkm4mAgAh+QQFCgAPACwAAAAADQANAAAENPDJSRSZeA418itN8QiK8BiLITVsFiyBBIoYqnoewAD4xPw9iY4XLGYSjkQR4UAUD45DLwIAIfkEBQoADwAsAAAAAA8ACQAABC\/wyVlamTi3nSdgwFNdhEJgTJoNyoB9ISYoQmdjiZPcj7EYCAeCF1gEDo4Dz2eIAAAh+QQFCgAPACwCAAAADQANAAAEM\/DJBxiYeLKdX3IJZT1FU0iIg2RNKx3OkZVnZ98ToRD4MyiDnkAh6BkNC0MvsAj0kMpHBAAh+QQFCgAPACwGAAAACQAPAAAEMDC59KpFDll73HkAA2wVY5KgiK5b0RRoI6MuzG6EQqCDMlSGheEhUAgqgUUAFRySIgAh+QQFCgAPACwCAAIADQANAAAEM\/DJKZNLND\/kkKaHc3xk+QAMYDKsiaqmZCxGVjSFFCxB1vwy2oOgIDxuucxAMTAJFAJNBAAh+QQFCgAPACwAAAYADwAJAAAEMNAs86q1yaWwwv2Ig0jUZx3OYa4XoRAfwADXoAwfo1+CIjyFRuEho60aSNYlOPxEAAAh+QQFCgAPACwAAAIADQANAAAENPA9s4y8+IUVcqaWJ4qEQozSoAzoIyhCK2NFU2SJk0hNnyEOhKR2AzAAj4Pj4GE4W0bkJQIAOw=="};
var PT_CV_PAGINATION = {"first":"\u00ab","prev":"\u2039","next":"\u203a","last":"\u00bb","goto_first":"Ir para a primeira p\u00e1gina","goto_prev":"Ir para a p\u00e1gina anterior","goto_next":"Ir para a pr\u00f3xima p\u00e1gina","goto_last":"Ir para a \u00faltima p\u00e1gina","current_page":"P\u00e1gina atual \u00e9","goto_page":"Ir para p\u00e1gina"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/content-views-query-and-display-post-page/public/assets/js/cv.js?ver=2.1.2'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201852'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jquery-collapse-o-matic/js/collapse.js?ver=1.6.14'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var JQLBSettings = {"fitToScreen":"0","resizeSpeed":"400","displayDownloadLink":"0","navbarOnTop":"0","loopImages":"","resizeCenter":"","marginSize":"","linkTarget":"","help":"","prevLinkTitle":"previous image","nextLinkTitle":"next image","prevLinkText":"\u00ab Previous","nextLinkText":"Next \u00bb","closeTitle":"close image gallery","image":"Image ","of":" of ","download":"Download","jqlb_overlay_opacity":"80","jqlb_overlay_color":"#000000","jqlb_overlay_close":"1","jqlb_border_width":"10","jqlb_border_color":"#ffffff","jqlb_border_radius":"0","jqlb_image_info_background_transparency":"100","jqlb_image_info_bg_color":"#ffffff","jqlb_image_info_text_color":"#000000","jqlb_image_info_text_fontsize":"10","jqlb_show_text_for_image":"1","jqlb_next_image_title":"next image","jqlb_previous_image_title":"previous image","jqlb_next_button_image":"https:\/\/www.tiagoneves.net\/blog\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/next.gif","jqlb_previous_button_image":"https:\/\/www.tiagoneves.net\/blog\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/prev.gif","jqlb_maximum_width":"","jqlb_maximum_height":"","jqlb_show_close_button":"1","jqlb_close_image_title":"close image gallery","jqlb_close_image_max_heght":"22","jqlb_image_for_close_lightbox":"https:\/\/www.tiagoneves.net\/blog\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/closelabel.gif","jqlb_keyboard_navigation":"1","jqlb_popup_size_fix":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/wp-lightbox-2/wp-lightbox-2.min.js?ver=1.3.4.1'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/wp-syntax/js/wp-syntax.js?ver=1.1'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2018Decaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/modules/wpgroho.js?ver=5.0.2'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/themes/pluto/js/navigation.js?ver=20120206'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/themes/pluto/js/skip-link-focus-fix.js?ver=20130115'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-includes/js/comment-reply.min.js?ver=5.0.2'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-includes/js/wp-embed.min.js?ver=5.0.2'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/postmessage.min.js?ver=6.8.1'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/jquery.jetpack-resize.min.js?ver=6.8.1'></script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/likes/queuehandler.min.js?ver=6.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.tiagoneves.net/blog/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=6.8.1'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-linkedin', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-twitter', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-telegram', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtelegram', 'menubar=1,resizable=1,width=450,height=450' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-skype', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomskype', 'menubar=1,resizable=1,width=305,height=665' );
				return false;
			});
</script>
<iframe src='https://widgets.wp.com/likes/master.html?ver=201852#ver=201852&amp;lang=pt-br' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> blogueiros gostam disto:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<!--[if IE]>
		<script type="text/javascript">
			if ( 0 === window.location.hash.indexOf( '#comment-' ) ) {
				// window.location.reload() doesn't respect the Hash in IE
				window.location.hash = window.location.hash;
			}
		</script>
		<![endif]-->
<script type="text/javascript">
			(function () {
				var comm_par_el = document.getElementById( 'comment_parent' ),
					comm_par = ( comm_par_el && comm_par_el.value ) ? comm_par_el.value : '',
					frame = document.getElementById( 'jetpack_remote_comment' ),
					tellFrameNewParent;

				tellFrameNewParent = function () {
					if ( comm_par ) {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=92165869&postid=1422&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=mystery&greeting=Deixe+uma+resposta&greeting_reply=Deixe+uma+resposta+para+%25s&color_scheme=light&lang=pt_BR&jetpack_version=6.8.1&show_cookie_consent=10&has_cookie_consent=0&sig=577c7a44971f37157c10fde591590ed565d437ca#parent=https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F" + '&replytocom=' + parseInt( comm_par, 10 ).toString();
					} else {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=92165869&postid=1422&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=mystery&greeting=Deixe+uma+resposta&greeting_reply=Deixe+uma+resposta+para+%25s&color_scheme=light&lang=pt_BR&jetpack_version=6.8.1&show_cookie_consent=10&has_cookie_consent=0&sig=577c7a44971f37157c10fde591590ed565d437ca#parent=https%3A%2F%2Fwww.tiagoneves.net%2Fblog%2Freplique-os-backups-de-sua-vm-sql-server-do-azure-para-amazon%2F";
					}
				};

				
				if ( 'undefined' !== typeof addComment ) {
					addComment._Jetpack_moveForm = addComment.moveForm;

					addComment.moveForm = function ( commId, parentId, respondId, postId ) {
						var returnValue = addComment._Jetpack_moveForm( commId, parentId, respondId, postId ),
							cancelClick, cancel;

						if ( false === returnValue ) {
							cancel = document.getElementById( 'cancel-comment-reply-link' );
							cancelClick = cancel.onclick;
							cancel.onclick = function () {
								var cancelReturn = cancelClick.call( this );
								if ( false !== cancelReturn ) {
									return cancelReturn;
								}

								if ( ! comm_par ) {
									return cancelReturn;
								}

								comm_par = 0;

								tellFrameNewParent();

								return cancelReturn;
							};
						}

						if ( comm_par == parentId ) {
							return returnValue;
						}

						comm_par = parentId;

						tellFrameNewParent();

						return returnValue;
					};
				}

				
				// Do the post message bit after the dom has loaded.
				document.addEventListener( 'DOMContentLoaded', function () {
					var iframe_url = "https:\/\/jetpack.wordpress.com";
					if ( window.postMessage ) {
						if ( document.addEventListener ) {
							window.addEventListener( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								jQuery( frame ).height( event.data );
							});
						} else if ( document.attachEvent ) {
							window.attachEvent( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								jQuery( frame ).height( event.data );
							});
						}
					}
				})

			})();
		</script>
<script type='text/javascript' src='https://stats.wp.com/e-201852.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:6.8.1',blog:'92165869',post:'1422',tz:'0',srv:'www.tiagoneves.net'} ]);
	_stq.push([ 'clickTrackerInit', '92165869', '1422' ]);
</script>
</body>
</html>